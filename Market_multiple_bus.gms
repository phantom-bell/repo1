sets
g generator list/g1*g16/
n bus     /n1*n24/
d demand  /d1*d17/

alias(n,m)
sets
MapN(n,n) Network topology /
n1.n2
n1.n3
n1.n4
n1.n5
n1.n6
n1.n7
n1.n8
n1.n9
n1.n10
n1.n11
n1.n12
n1.n13
n1.n14
n1.n15
n1.n16
n1.n17
n1.n18
n1.n19
n1.n20
n1.n21
n1.n22
n1.n23
n1.n24
n2.n1
n2.n3
n2.n4
n2.n5
n2.n6
n2.n7
n2.n8
n2.n9
n2.n10
n2.n11
n2.n12
n2.n13
n2.n14
n2.n15
n2.n16
n2.n17
n2.n18
n2.n19
n2.n20
n2.n21
n2.n22
n2.n23
n2.n24
n3.n1
n3.n2
n3.n4
n3.n5
n3.n6
n3.n7
n3.n8
n3.n9
n3.n10
n3.n11
n3.n12
n3.n13
n3.n14
n3.n15
n3.n16
n3.n17
n3.n18
n3.n19
n3.n20
n3.n21
n3.n22
n3.n23
n3.n24
n4.n1
n4.n2
n4.n3
n4.n5
n4.n6
n4.n7
n4.n8
n4.n9
n4.n10
n4.n11
n4.n12
n4.n13
n4.n14
n4.n15
n4.n16
n4.n17
n4.n18
n4.n19
n4.n20
n4.n21
n4.n22
n4.n23
n4.n24
n5.n1
n5.n2
n5.n3
n5.n4
n5.n6
n5.n7
n5.n8
n5.n9
n5.n10
n5.n11
n5.n12
n5.n13
n5.n14
n5.n15
n5.n16
n5.n17
n5.n18
n5.n19
n5.n20
n5.n21
n5.n22
n5.n23
n5.n24
n6.n1
n6.n2
n6.n3
n6.n4
n6.n5
n6.n7
n6.n8
n6.n9
n6.n10
n6.n11
n6.n12
n6.n13
n6.n14
n6.n15
n6.n16
n6.n17
n6.n18
n6.n19
n6.n20
n6.n21
n6.n22
n6.n23
n6.n24
n7.n1
n7.n2
n7.n3
n7.n4
n7.n5
n7.n6
n7.n8
n7.n9
n7.n10
n7.n11
n7.n12
n7.n13
n7.n14
n7.n15
n7.n16
n7.n17
n7.n18
n7.n19
n7.n20
n7.n21
n7.n22
n7.n23
n7.n24
n8.n1
n8.n2
n8.n3
n8.n4
n8.n5
n8.n6
n8.n7
n8.n9
n8.n10
n8.n11
n8.n12
n8.n13
n8.n14
n8.n15
n8.n16
n8.n17
n8.n18
n8.n19
n8.n20
n8.n21
n8.n22
n8.n23
n8.n24
n9.n1
n9.n2
n9.n3
n9.n4
n9.n5
n9.n6
n9.n7
n9.n8
n9.n10
n9.n11
n9.n12
n9.n13
n9.n14
n9.n15
n9.n16
n9.n17
n9.n18
n9.n19
n9.n20
n9.n21
n9.n22
n9.n23
n9.n24
n10.n1
n10.n2
n10.n3
n10.n4
n10.n5
n10.n6
n10.n7
n10.n8
n10.n9
n10.n11
n10.n12
n10.n13
n10.n14
n10.n15
n10.n16
n10.n17
n10.n18
n10.n19
n10.n20
n10.n21
n10.n22
n10.n23
n10.n24
n11.n1
n11.n2
n11.n3
n11.n4
n11.n5
n11.n6
n11.n7
n11.n8
n11.n9
n11.n10
n11.n12
n11.n13
n11.n14
n11.n15
n11.n16
n11.n17
n11.n18
n11.n19
n11.n20
n11.n21
n11.n22
n11.n23
n11.n24
n12.n1
n12.n2
n12.n3
n12.n4
n12.n5
n12.n6
n12.n7
n12.n8
n12.n9
n12.n10
n12.n11
n12.n13
n12.n14
n12.n15
n12.n16
n12.n17
n12.n18
n12.n19
n12.n20
n12.n21
n12.n22
n12.n23
n12.n24
n13.n1
n13.n2
n13.n3
n13.n4
n13.n5
n13.n6
n13.n7
n13.n8
n13.n9
n13.n10
n13.n11
n13.n12
n13.n14
n13.n15
n13.n16
n13.n17
n13.n18
n13.n19
n13.n20
n13.n21
n13.n22
n13.n23
n13.n24
n14.n1
n14.n2
n14.n3
n14.n4
n14.n5
n14.n6
n14.n7
n14.n8
n14.n9
n14.n10
n14.n11
n14.n12
n14.n13
n14.n15
n14.n16
n14.n17
n14.n18
n14.n19
n14.n20
n14.n21
n14.n22
n14.n23
n14.n24
n15.n1
n15.n2
n15.n3
n15.n4
n15.n5
n15.n6
n15.n7
n15.n8
n15.n9
n15.n10
n15.n11
n15.n12
n15.n13
n15.n14
n15.n16
n15.n17
n15.n18
n15.n19
n15.n20
n15.n21
n15.n22
n15.n23
n15.n24
n16.n1
n16.n2
n16.n3
n16.n4
n16.n5
n16.n6
n16.n7
n16.n8
n16.n9
n16.n10
n16.n11
n16.n12
n16.n13
n16.n14
n16.n15
n16.n17
n16.n18
n16.n19
n16.n20
n16.n21
n16.n22
n16.n23
n16.n24
n17.n1
n17.n2
n17.n3
n17.n4
n17.n5
n17.n6
n17.n7
n17.n8
n17.n9
n17.n10
n17.n11
n17.n12
n17.n13
n17.n14
n17.n15
n17.n16
n17.n18
n17.n19
n17.n20
n17.n21
n17.n22
n17.n23
n17.n24
n18.n1
n18.n2
n18.n3
n18.n4
n18.n5
n18.n6
n18.n7
n18.n8
n18.n9
n18.n10
n18.n11
n18.n12
n18.n13
n18.n14
n18.n15
n18.n16
n18.n17
n18.n19
n18.n20
n18.n21
n18.n22
n18.n23
n18.n24
n19.n1
n19.n2
n19.n3
n19.n4
n19.n5
n19.n6
n19.n7
n19.n8
n19.n9
n19.n10
n19.n11
n19.n12
n19.n13
n19.n14
n19.n15
n19.n16
n19.n17
n19.n18
n19.n20
n19.n21
n19.n22
n19.n23
n19.n24
n20.n1
n20.n2
n20.n3
n20.n4
n20.n5
n20.n6
n20.n7
n20.n8
n20.n9
n20.n10
n20.n11
n20.n12
n20.n13
n20.n14
n20.n15
n20.n16
n20.n17
n20.n18
n20.n19
n20.n21
n20.n22
n20.n23
n20.n24
n21.n1
n21.n2
n21.n3
n21.n4
n21.n5
n21.n6
n21.n7
n21.n8
n21.n9
n21.n10
n21.n11
n21.n12
n21.n13
n21.n14
n21.n15
n21.n16
n21.n17
n21.n18
n21.n19
n21.n20
n21.n22
n21.n23
n21.n24
n22.n1
n22.n2
n22.n3
n22.n4
n22.n5
n22.n6
n22.n7
n22.n8
n22.n9
n22.n10
n22.n11
n22.n12
n22.n13
n22.n14
n22.n15
n22.n16
n22.n17
n22.n18
n22.n19
n22.n20
n22.n21
n22.n23
n22.n24
n23.n1
n23.n2
n23.n3
n23.n4
n23.n5
n23.n6
n23.n7
n23.n8
n23.n9
n23.n10
n23.n11
n23.n12
n23.n13
n23.n14
n23.n15
n23.n16
n23.n17
n23.n18
n23.n19
n23.n20
n23.n21
n23.n22
n23.n24
n24.n1
n24.n2
n24.n3
n24.n4
n24.n5
n24.n6
n24.n7
n24.n8
n24.n9
n24.n10
n24.n11
n24.n12
n24.n13
n24.n14
n24.n15
n24.n16
n24.n17
n24.n18
n24.n19
n24.n20
n24.n21
n24.n22
n24.n23
/

MapG(g,n) location of Generator/
g1.n1
g2.n2
g3.n7
g4.n13
g5.n15
g6.n15
g7.n16
g8.n18
g9.n21
g10.n22
g11.n23
g12.n23
g13.n3
g14.n5
g15.n16
g16.n21

/
MapD(d,n) location of demand/
d1.n1
d2.n2
d3.n3
d4.n4
d5.n5
d6.n6
d7.n7
d8.n8
d9.n9
d10.n10
d11.n13
d12.n14
d13.n15
d14.n16
d15.n18
d16.n19
d17.n20
/
;
Parameter PGmax (g) Capacity of Generators[MW]/
g13        120
g14        115
g15        53
g16        38
g1        106.4
g2        106.4
g3        245
g4        413.7
g5        42
g6        108.5
g7        108.5
g8        280
g9        280
g10        210
g11        217
g12        245



/;

Parameter C(g) Offer Price of Generators[Rs per MWh]/
g13       0.0
g14       0.0
g15       0.0
g16       0.0
g1        13.32
g2        13.32
g3        20.7
g4        20.93
g5        26.11
g6        10.52
g7        10.52
g8        6.02
g9        5.47
g10        7
g11        10.52
g12        10.89



/;

Parameter L(d) Maximum load of Demand[MW]/
d1        84
d2        75
d3        139
d4        58
d5        55
d6        106
d7        97
d8        132
d9        135
d10        150
d11        205
d12        150
d13        245
d14        77
d15        258
d16        141
d17        100

/;

Parameter U(d)  Price of Utility [Rs per MWh]/
d1        30
d2        34
d3        35
d4        40
d5        30
d6        35.6
d7        36.2
d8        36.8
d9        37.4
d10        38
d11        38.6
d12        39.2
d13        39.8
d14        40.4
d15        41
d16        41.6
d17        42.2

/;

Table Fmax(n,n) Capacity of Transmission Line in MW
           n1        n2      n3       n4       n5       n6       n7       n8       n9       n10      n11      n12      n13      n14      n15      n16      n17      n18      n19      n20      n21      n22      n23      n24
n1         0        175      175      0        350      0        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0
n2         175        0      0        175      0        175      0        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0
n3         175        0      0        0        0        0        0        0        175      0        0        0        0        0        0        0        0        0        0        0        0        0        0        400
n4         0        175      0        0        0        0        0        0        175      0        0        0        0        0        0        0        0        0        0        0        0        0        0        0
n5         350        0      0        0        0        0        0        0        0        350      0        0        0        0        0        0        0        0        0        0        0        0        0        0
n6         0        175      0        0        0        0        0        0        0        175      0        0        0        0        0        0        0        0        0        0        0        0        0        0
n7         0        0        0        0        0        0        0        350      0        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0
n8         0        0        0        0        0        0        350      0        175      175      0        0        0        0        0        0        0        0        0        0        0        0        0        0
n9         0        0        175      175      0        0        0        175      0        0        400      400      0        0        0        0        0        0        0        0        0        0        0        0
n10        0        0        0        0        350      175      0        175      0        0        400      400      0        0        0        0        0        0        0        0        0        0        0        0
n11        0        0        0        0        0        0        0        0        400      400      0        0        500      500      0        0        0        0        0        0        0        0        0        0
n12        0        0        0        0        0        0        0        0        400      400      0        0        500      0        0        0        0        0        0        0        0        0        500      0
n13        0        0        0        0        0        0        0        0        0        0        500      500      0        0        0        0        0        0        0        0        0        0        250      0
n14        0        0        0        0        0        0        0        0        0        0        500      0        0        0        0        250      0        0        0        0        0        0        0        0
n15        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0        500      0        0        0        0        400      0        0        500
n16        0        0        0        0        0        0        0        0        0        0        0        0        0        250      500      0        500      0        500      0        0        0        0        0
n17        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0        500      0        500      0        0        0        500      0        0
n18        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0        500      0        0        0        1000     0        0        0
n19        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0        500      0        0        0        1000     0        0        0        0
n20        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0        1000     0        0        0        1000     0
n21        0        0        0        0        0        0        0        0        0        0        0        0        0        0        400      0        0        1000     0        0        0        500      0        0
n22        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0        500      0        0        0        500      0        0        0
n23        0        0        0        0        0        0        0        0        0        0        0        500      250      0        0        0        0        0        0        1000     0        0        0        0
n24        0        0        400      0        0        0        0        0        0        0        0        0        0        0        500      0        0        0        0        0        0        0        0        0

;

Table b(n,n) SUSCEPTANCE of Transmission Line in MW
           n1       n2       n3       n4       n5       n6       n7       n8       n9       n10      n11      n12      n13      n14      n15      n16      n17      n18      n19      n20      n21      n22      n23      n24
n1         0        68       4        0        11       0        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0
n2         68       0        0        7        0        5        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0
n3         4        0        0        0        0        0        0        0        8        0        0        0        0        0        0        0        0        0        0        0        0        0        0        12
n4         0        7        0        0        0        0        0        0        9        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0
n5         11       0        0        0        0        0        0        0        0        11       0        0        0        0        0        0        0        0        0        0        0        0        0        0
n6         0        5        0        0        0        0        0        0        0        16       0        0        0        0        0        0        0        0        0        0        0        0        0        0
n7         0        0        0        0        0        0        0        15       0        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0
n8         0        0        0        0        0        0        15       0        6        6        0        0        0        0        0        0        0        0        0        0        0        0        0        0
n9         0        0        8        9        0        0        0        6        0        0        12       12       0        0        0        0        0        0        0        0        0        0        0        0
n10        0        0        0        0        11       16       0        6        0        0        12       12       0        0        0        0        0        0        0        0        0        0        0        0
n11        0        0        0        0        0        0        0        0        12       12       0        0        20       23       0        0        0        0        0        0        0        0        0        0
n12        0        0        0        0        0        0        0        0        12       12       0        0        20       0        0        0        0        0        0        0        0        0        10       0
n13        0        0        0        0        0        0        0        0        0        0        20       20       0        0        0        0        0        0        0        0        0        0        11       0
n14        0        0        0        0        0        0        0        0        0        0        23       0        0        0        0        17       0        0        0        0        0        0        0        0
n15        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0        58       0        0        0        0        40       0        0        19
n16        0        0        0        0        0        0        0        0        0        0        0        0        0        17       58       0        38       0        43       0        0        0        0        0
n17        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0        38       0        70       0        0        0        9        0        0
n18        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0        70       0        0        0        76       0        0        0
n19        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0        43       0        0        0        49       0        0        0        0
n20        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0        49       0        0        0        89       0
n21        0        0        0        0        0        0        0        0        0        0        0        0        0        0        40       0        0        76       0        0        0        14       0        0
n22        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0        9        0        0        0        14       0        0        0
n23        0        0        0        0        0        0        0        0        0        0        0        10       11       0        0        0        0        0        0        89       0        0        0        0
n24        0        0        12       0        0        0        0        0        0        0        0        0        0        0        19       0        0        0        0        0        0        0        0        0

;


free variable
MS     Market Surplus[Rs]
f(n,m) Power Flow from bus n to m[MW]
theta(n) Voltage angle of bus n[rad.];

Positive variable

p_D(d) Consumption level of demand d [MW]
p_G(g) Production level of Generator g[MW]  ;

Equations
obj, cons1,cons2,cons3,cons4,cons5,cons6;

obj..           MS          =e= sum(d,U(d)*p_D(d))-sum(g,C(g)*p_G(g) );
cons1(g)..      p_G(g)      =l=PGmax(g);
cons2(d)..      p_D(d)      =l=L(d);
***Transmission limits of line from bus n to m

cons3(n,m)..    f(n,m)      =e=B(n,m)*(theta(n) -theta(m));
cons4(n,m)..    f(n,m)      =l=Fmax(n,m);
cons5..         theta('N1') =e=0;
******************power flow equation************
**it will give you nodal price
cons6(n)..     -sum(g$MapG(g,n),p_G(g))+sum(d$MapD(d,n),p_D(d))
               +sum(m$MapN(n,m),f(n,m))=e=0;

Model Market_Clearing /all/;
Solve Market_Clearing using lp maximizing MS
Display MS.l,p_G.l,p_D.l,f.l,cons6.m;



*=== Export to Excel using GDX utilities

*=== First unload to GDX file (occurs during execution phase)
*execute_unload "results.gdx" MS.l,p_G.l,p_D.l,f.l,cons6.m;

*=== Now write to variable levels to Excel file from GDX
*=== Since we do not specify a sheet, data is placed in first sheet
*execute 'gdxxrw.exe results.gdx o=results.xlsx var=x.L'

*=== Write marginals to a different sheet with a specific range
*execute 'gdxxrw.exe  results.gdx o=results.xls =cons6.m rng=NewSheet!a1'





